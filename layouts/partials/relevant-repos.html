<style>
.relevant-repos-group { background: linear-gradient(90deg, #0a0a0a 80%, #181818 100%); border-radius: 14px; box-shadow: 0 4px 18px rgba(0,0,0,0.18); border: 1.5px solid #181818; margin-bottom: 2.2em; padding: 1.1em 1.2em 0.5em 1.2em; transition: box-shadow 0.2s; }
.relevant-repos-group.collapsed { padding-bottom: 0.2em; }
.relevant-repos-group h3 { cursor: pointer; user-select: none; margin-top: 0.1em; margin-bottom: 0.2em !important; display: flex; align-items: center; gap: 0.5em; font-size: 1.18em; color: #fff; transition: color 0.2s; }
.relevant-repos-group h3 .arrow { font-size: 1.1em; transition: transform 0.2s; display: inline-block; color: #ff6f00; }
.relevant-repos-group.collapsed h3 .arrow { transform: rotate(-90deg); }
.relevant-repos-group .repos-list { transition: max-height 0.25s cubic-bezier(.4,0,.2,1), opacity 0.2s; overflow: hidden; opacity: 1; max-height: 500px; scrollbar-width: thin; scrollbar-color: var(--primary) transparent; }
.relevant-repos-group .repos-list::-webkit-scrollbar { height: 20px; }
.relevant-repos-group .repos-list::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 6px; border: 2px solid rgba(0,0,0,0.15); }
.relevant-repos-group.collapsed .repos-list { opacity: 0; max-height: 0; pointer-events: none; }
.repo-pill { flex: 0 0 auto; display: block; min-width: 220px; border-radius: 8px; padding: 1em 1.2em; background: rgba(0,0,0,0.10); color: #ff6f00; text-decoration: none; box-shadow: 0 2px 8px rgba(0,0,0,0.08); transition: background 0.2s, transform 0.2s; }
.repo-pill:hover { background: rgba(0,0,0,0.15); transform: translateY(-2px); text-decoration: none; color: #ff6f00; }
.repo-title { font-size: 1.1em; font-weight: bold; margin-bottom: 0.3em; }
.repo-quip { font-size: 0.98em; color: #ddd; margin: 0.2em 0 0.4em 0; }
.repo-desc { font-size: 0.92em; color: #999; }
.repo-desc-popup-global { position: absolute; z-index: 1000; background: #1a1a1a; color: #ddd; padding: 0.8em 1em; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); border: 1px solid #333; max-width: 300px; font-size: 0.9em; line-height: 1.4; display: none; pointer-events: none; }
</style>

<section class="relevant-repos" style="margin:2.5rem 0 2rem 0;">
  <h2 style="color:var(--primary);margin-bottom:1.2rem;">Relevant Repos</h2>
  <div id="github-relevant-repos-groups">
    {{- range .Site.Data.repos }}
    <div class="relevant-repos-group">
      <h3>
        <span class="arrow">&#9654;</span>
        <span>{{ .title }}</span>
      </h3>
      <div class="repos-list" style="display: flex; overflow-x: auto; gap: 1.2em; padding-bottom: 0.25rem; -webkit-overflow-scrolling: touch;">
        {{- range .repos }}
        <a href="https://github.com/{{ .owner }}/{{ .repo }}" 
           target="_blank" 
           class="repo-pill"
           data-full-desc="{{ .desc | default "No description available" }}">
          <div class="repo-title">{{ .owner }}/{{ .repo }}</div>
          <div class="repo-quip">{{ .quip | default "No quip available" }}</div>
          <div class="repo-desc">
            {{- $desc := (.desc | default "No description available") -}}
            {{- if gt (len $desc) 64 -}}
              {{ substr $desc 0 64 }}...
            {{- else -}}
              {{ $desc }}
            {{- end -}}
          </div>
        </a>
        {{- end }}
      </div>
    </div>
    {{- end }}
  </div>
</section>

<script>
(function(){
  // Add collapse/expand functionality only
  const repoGroups = document.querySelectorAll('.relevant-repos-group');
  
  repoGroups.forEach(function(group) {
    const groupTitle = group.querySelector('h3');
    if (groupTitle) {
      groupTitle.addEventListener('click', function(e) {
        group.classList.toggle('collapsed');
      });
    }
  });

  // Tooltip functionality for full descriptions
  const globalTT = document.createElement('div');
  globalTT.className = 'repo-desc-popup-global';
  globalTT.id = 'repo-desc-popup-global';
  globalTT.setAttribute('role','tooltip');
  document.body.appendChild(globalTT);
  
  function clampPosition(x,y,tooltip){
    var tw = tooltip.offsetWidth, th = tooltip.offsetHeight;
    var pad = 8;
    var maxX = window.scrollX + window.innerWidth - tw - pad;
    var maxY = window.scrollY + window.innerHeight - th - pad;
    var nx = Math.min(maxX, Math.max(window.scrollX + pad, x));
    var ny = Math.min(maxY, Math.max(window.scrollY + pad, y));
    return {x: nx, y: ny};
  }
  
  var pointerShownFor = null;
  
  document.addEventListener('mouseover', function(e){
    var pill = e.target.closest('.repo-pill');
    if (!pill) return;
    var full = pill.dataset.fullDesc;
    if (!full) return;
    globalTT.innerHTML = full;
    globalTT.style.display = 'block';
    pointerShownFor = pill;
    var pos = clampPosition(e.pageX + 12, e.pageY + 12, globalTT);
    globalTT.style.left = pos.x + 'px'; 
    globalTT.style.top = pos.y + 'px';
  });
  
  document.addEventListener('mousemove', function(e){ 
    if (globalTT.style.display === 'block') { 
      var pos = clampPosition(e.pageX + 12, e.pageY + 12, globalTT); 
      globalTT.style.left = pos.x + 'px'; 
      globalTT.style.top = pos.y + 'px'; 
    } 
  });
  
  document.addEventListener('mouseout', function(e){
    var related = e.relatedTarget;
    if (!related || !related.closest || !related.closest('.repo-pill')) {
      globalTT.style.display = 'none'; 
      pointerShownFor = null;
    }
  });
})();
</script>
